# Story 1.6: User/Host Mode Toggle

## Status

Draft

## Story

**As a** registered host,
**I want** to switch between User and Host modes,
**so that** I can use the app as a customer or manage my hosting.

## Acceptance Criteria

1. Bottom navigation shows mode indicator (User/Host)
2. Mode toggle accessible from profile or dedicated switch button
3. User mode shows: Home (search), My Orders, Chat, Profile
4. Host mode shows: Dashboard, Calendar, Earnings, Chat, Profile
5. Mode preference persisted locally
6. Non-hosts see only User mode (Host option hidden until registered)
7. Smooth transition animation between modes

## Tasks / Subtasks

- [ ] Task 1: Create mode store with persistence (AC: 5)
  - [ ] Create `src/stores/modeStore.ts` with Zustand
  - [ ] Add `mode` state ('user' | 'host')
  - [ ] Add `setMode(mode)` action
  - [ ] Configure AsyncStorage persistence
  - [ ] Initialize mode from stored preference on app load

- [ ] Task 2: Create User mode bottom tab navigator (AC: 3)
  - [ ] Create `src/navigation/UserTabNavigator.tsx`
  - [ ] Add Home tab (search placeholder screen)
  - [ ] Add My Orders tab (orders placeholder screen)
  - [ ] Add Chat tab (chat placeholder screen)
  - [ ] Add Profile tab (existing profile screen)
  - [ ] Style tabs with icons and labels

- [ ] Task 3: Create Host mode bottom tab navigator (AC: 4)
  - [ ] Create `src/navigation/HostTabNavigator.tsx`
  - [ ] Add Dashboard tab (dashboard placeholder screen)
  - [ ] Add Calendar tab (calendar placeholder screen)
  - [ ] Add Earnings tab (earnings placeholder screen)
  - [ ] Add Chat tab (chat placeholder screen)
  - [ ] Add Profile tab (existing profile screen)
  - [ ] Style tabs with icons and labels

- [ ] Task 4: Create placeholder screens for tabs
  - [ ] Create `src/screens/user/HomeScreen.tsx` (search placeholder)
  - [ ] Create `src/screens/user/OrdersScreen.tsx` (orders placeholder)
  - [ ] Create `src/screens/shared/ChatListScreen.tsx` (chat list placeholder)
  - [ ] Create `src/screens/host/DashboardScreen.tsx` (dashboard placeholder)
  - [ ] Create `src/screens/host/CalendarScreen.tsx` (calendar placeholder)
  - [ ] Create `src/screens/host/EarningsScreen.tsx` (earnings placeholder)
  - [ ] Create `src/screens/shared/ProfileScreen.tsx` (settings/profile)

- [ ] Task 5: Create mode toggle component (AC: 1, 2)
  - [ ] Create `src/components/common/ModeToggle.tsx`
  - [ ] Display current mode with icon (User/Host)
  - [ ] Show toggle switch or button to change mode
  - [ ] Add visual feedback for current mode
  - [ ] Conditionally render only if user is a host (AC: 6)

- [ ] Task 6: Update MainNavigator with mode switching (AC: 3, 4)
  - [ ] Create `src/navigation/MainNavigator.tsx`
  - [ ] Render UserTabNavigator when mode is 'user'
  - [ ] Render HostTabNavigator when mode is 'host'
  - [ ] Subscribe to modeStore for reactive switching

- [ ] Task 7: Add mode toggle to navigation header (AC: 2)
  - [ ] Add ModeToggle to header or dedicated location
  - [ ] Ensure visibility across all screens
  - [ ] Position consistently (e.g., top-right corner)

- [ ] Task 8: Add mode indicator to bottom navigation (AC: 1)
  - [ ] Style bottom tabs differently for User vs Host mode
  - [ ] Use distinct colors or visual treatment per mode
  - [ ] Show mode label in tab bar if space allows

- [ ] Task 9: Implement transition animation (AC: 7)
  - [ ] Add fade or slide animation when switching modes
  - [ ] Use React Navigation's built-in animation options
  - [ ] Ensure smooth visual transition between tab navigators

- [ ] Task 10: Hide host option for non-hosts (AC: 6)
  - [ ] Check `useIsHost()` from authStore
  - [ ] Hide ModeToggle entirely if not a host
  - [ ] Default and lock to 'user' mode if not a host
  - [ ] Show "Become a Host" option instead of toggle

- [ ] Task 11: Write tests for mode toggle
  - [ ] Test modeStore state changes
  - [ ] Test modeStore persistence
  - [ ] Test ModeToggle renders correctly for hosts
  - [ ] Test ModeToggle hidden for non-hosts
  - [ ] Test navigation switches between tab navigators

## Dev Notes

### Mode State Pattern
[Source: docs/architecture.md#section-10.3]

```typescript
// stores/modeStore.ts
import { create } from 'zustand';
import { persist, createJSONStorage } from 'zustand/middleware';
import AsyncStorage from '@react-native-async-storage/async-storage';

type AppMode = 'user' | 'host';

interface ModeState {
  mode: AppMode;
  setMode: (mode: AppMode) => void;
}

export const useModeStore = create<ModeState>()(
  persist(
    (set) => ({
      mode: 'user',
      setMode: (mode) => set({ mode }),
    }),
    {
      name: 'mode-storage',
      storage: createJSONStorage(() => AsyncStorage),
    }
  )
);

// Hook for easy access
export const useAppMode = () => useModeStore((state) => state.mode);
export const useSetMode = () => useModeStore((state) => state.setMode);
```

### Navigation Structure Pattern
[Source: docs/architecture.md#section-10.4]

```typescript
// navigation/MainNavigator.tsx
import { useModeStore } from '@/stores/modeStore';
import { useIsHost } from '@/stores/authStore';
import { UserTabNavigator } from './UserTabNavigator';
import { HostTabNavigator } from './HostTabNavigator';

export function MainNavigator() {
  const mode = useModeStore((state) => state.mode);
  const isHost = useIsHost();

  // Force user mode if not a host
  const effectiveMode = isHost ? mode : 'user';

  return effectiveMode === 'host' ? (
    <HostTabNavigator />
  ) : (
    <UserTabNavigator />
  );
}
```

### User Tab Navigator Structure
```typescript
// navigation/UserTabNavigator.tsx
import { createBottomTabNavigator } from '@react-navigation/bottom-tabs';
import { Ionicons } from '@expo/vector-icons';
import HomeScreen from '@/screens/user/HomeScreen';
import OrdersScreen from '@/screens/user/OrdersScreen';
import ChatListScreen from '@/screens/shared/ChatListScreen';
import ProfileScreen from '@/screens/shared/ProfileScreen';

const Tab = createBottomTabNavigator();

export function UserTabNavigator() {
  return (
    <Tab.Navigator
      screenOptions={({ route }) => ({
        tabBarIcon: ({ focused, color, size }) => {
          let iconName: keyof typeof Ionicons.glyphMap;

          switch (route.name) {
            case 'Home':
              iconName = focused ? 'home' : 'home-outline';
              break;
            case 'Orders':
              iconName = focused ? 'receipt' : 'receipt-outline';
              break;
            case 'Chat':
              iconName = focused ? 'chatbubbles' : 'chatbubbles-outline';
              break;
            case 'Profile':
              iconName = focused ? 'person' : 'person-outline';
              break;
            default:
              iconName = 'help-outline';
          }

          return <Ionicons name={iconName} size={size} color={color} />;
        },
        tabBarActiveTintColor: '#007AFF', // User mode color
        tabBarInactiveTintColor: 'gray',
      })}
    >
      <Tab.Screen name="Home" component={HomeScreen} />
      <Tab.Screen name="Orders" component={OrdersScreen} />
      <Tab.Screen name="Chat" component={ChatListScreen} />
      <Tab.Screen name="Profile" component={ProfileScreen} />
    </Tab.Navigator>
  );
}
```

### Host Tab Navigator Structure
```typescript
// navigation/HostTabNavigator.tsx
import { createBottomTabNavigator } from '@react-navigation/bottom-tabs';
import { Ionicons } from '@expo/vector-icons';
import DashboardScreen from '@/screens/host/DashboardScreen';
import CalendarScreen from '@/screens/host/CalendarScreen';
import EarningsScreen from '@/screens/host/EarningsScreen';
import ChatListScreen from '@/screens/shared/ChatListScreen';
import ProfileScreen from '@/screens/shared/ProfileScreen';

const Tab = createBottomTabNavigator();

export function HostTabNavigator() {
  return (
    <Tab.Navigator
      screenOptions={({ route }) => ({
        tabBarIcon: ({ focused, color, size }) => {
          let iconName: keyof typeof Ionicons.glyphMap;

          switch (route.name) {
            case 'Dashboard':
              iconName = focused ? 'grid' : 'grid-outline';
              break;
            case 'Calendar':
              iconName = focused ? 'calendar' : 'calendar-outline';
              break;
            case 'Earnings':
              iconName = focused ? 'wallet' : 'wallet-outline';
              break;
            case 'Chat':
              iconName = focused ? 'chatbubbles' : 'chatbubbles-outline';
              break;
            case 'Profile':
              iconName = focused ? 'person' : 'person-outline';
              break;
            default:
              iconName = 'help-outline';
          }

          return <Ionicons name={iconName} size={size} color={color} />;
        },
        tabBarActiveTintColor: '#34C759', // Host mode color (green for earnings)
        tabBarInactiveTintColor: 'gray',
      })}
    >
      <Tab.Screen name="Dashboard" component={DashboardScreen} />
      <Tab.Screen name="Calendar" component={CalendarScreen} />
      <Tab.Screen name="Earnings" component={EarningsScreen} />
      <Tab.Screen name="Chat" component={ChatListScreen} />
      <Tab.Screen name="Profile" component={ProfileScreen} />
    </Tab.Navigator>
  );
}
```

### Mode Toggle Component
```typescript
// components/common/ModeToggle.tsx
import { View, TouchableOpacity, Text, StyleSheet } from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import { useModeStore } from '@/stores/modeStore';
import { useIsHost } from '@/stores/authStore';

export function ModeToggle() {
  const mode = useModeStore((state) => state.mode);
  const setMode = useModeStore((state) => state.setMode);
  const isHost = useIsHost();

  // Don't render if user is not a host
  if (!isHost) return null;

  const toggleMode = () => {
    setMode(mode === 'user' ? 'host' : 'user');
  };

  return (
    <TouchableOpacity onPress={toggleMode} style={styles.container}>
      <View style={[styles.toggle, mode === 'host' && styles.hostMode]}>
        <Ionicons
          name={mode === 'user' ? 'person' : 'business'}
          size={20}
          color={mode === 'host' ? '#34C759' : '#007AFF'}
        />
        <Text style={[styles.label, mode === 'host' && styles.hostLabel]}>
          {mode === 'user' ? 'User' : 'Host'}
        </Text>
      </View>
    </TouchableOpacity>
  );
}

const styles = StyleSheet.create({
  container: {
    padding: 8,
  },
  toggle: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: '#E5E5EA',
    paddingHorizontal: 12,
    paddingVertical: 6,
    borderRadius: 16,
  },
  hostMode: {
    backgroundColor: '#D4EDDA',
  },
  label: {
    marginLeft: 6,
    fontSize: 14,
    fontWeight: '600',
    color: '#007AFF',
  },
  hostLabel: {
    color: '#34C759',
  },
});
```

### Placeholder Screen Pattern
```typescript
// screens/host/DashboardScreen.tsx
import { View, Text, StyleSheet } from 'react-native';

export default function DashboardScreen() {
  return (
    <View style={styles.container}>
      <Text style={styles.title}>Host Dashboard</Text>
      <Text style={styles.subtitle}>Coming soon in Epic 4</Text>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: '#F5F5F5',
  },
  title: {
    fontSize: 24,
    fontWeight: 'bold',
    marginBottom: 8,
  },
  subtitle: {
    fontSize: 16,
    color: '#666',
  },
});
```

### Source Tree for Mode Toggle
```
src/
├── navigation/
│   ├── RootNavigator.tsx           # Update - use MainNavigator
│   ├── MainNavigator.tsx           # To be created - mode switching
│   ├── AuthNavigator.tsx           # Existing
│   ├── UserTabNavigator.tsx        # To be created
│   └── HostTabNavigator.tsx        # To be created
├── screens/
│   ├── user/
│   │   ├── HomeScreen.tsx          # To be created (placeholder)
│   │   └── OrdersScreen.tsx        # To be created (placeholder)
│   ├── host/
│   │   ├── DashboardScreen.tsx     # To be created (placeholder)
│   │   ├── CalendarScreen.tsx      # To be created (placeholder)
│   │   ├── EarningsScreen.tsx      # To be created (placeholder)
│   │   └── HostRegistrationScreen.tsx  # From Story 1.5
│   └── shared/
│       ├── ChatListScreen.tsx      # To be created (placeholder)
│       └── ProfileScreen.tsx       # To be created (with mode toggle)
├── components/
│   └── common/
│       └── ModeToggle.tsx          # To be created
└── stores/
    ├── authStore.ts                # Existing (has useIsHost)
    └── modeStore.ts                # To be created
```

### Transition Animation Configuration
```typescript
// navigation/MainNavigator.tsx - With animation
import { TransitionPresets } from '@react-navigation/stack';

// For fade transition between modes
const screenOptions = {
  ...TransitionPresets.FadeFromBottomAndroid,
  gestureEnabled: false,
};

// Alternative: Use React Native's Animated API for custom transitions
import Animated, {
  useAnimatedStyle,
  withTiming,
  FadeIn,
  FadeOut
} from 'react-native-reanimated';

// Wrap navigators in Animated.View with entering/exiting props
```

### Visual Differentiation Between Modes

| Aspect | User Mode | Host Mode |
|--------|-----------|-----------|
| Primary Color | Blue (#007AFF) | Green (#34C759) |
| Tab Bar Tint | Blue | Green |
| Header Style | Default | Green accent |
| Mode Indicator | User icon | Business/Host icon |

### Dependencies to Install

```bash
npx expo install @expo/vector-icons
```

Note: `@react-navigation/bottom-tabs` should already be installed from Story 1.1.

### Testing

**Test Location:** `apps/mobile-web/__tests__/`

**Testing Framework:** Jest + @testing-library/react

**Required Tests:**
- `__tests__/stores/modeStore.test.ts`
- `__tests__/components/ModeToggle.test.tsx`
- `__tests__/navigation/MainNavigator.test.tsx`

**Testing Pattern:**
```typescript
// Test mode store
describe('modeStore', () => {
  it('defaults to user mode', () => {
    const mode = useModeStore.getState().mode;
    expect(mode).toBe('user');
  });

  it('can switch to host mode', () => {
    useModeStore.getState().setMode('host');
    expect(useModeStore.getState().mode).toBe('host');
  });
});

// Test ModeToggle visibility
jest.mock('@/stores/authStore', () => ({
  useIsHost: jest.fn(),
}));

describe('ModeToggle', () => {
  it('renders for hosts', () => {
    (useIsHost as jest.Mock).mockReturnValue(true);
    const { getByText } = render(<ModeToggle />);
    expect(getByText(/user|host/i)).toBeTruthy();
  });

  it('does not render for non-hosts', () => {
    (useIsHost as jest.Mock).mockReturnValue(false);
    const { queryByText } = render(<ModeToggle />);
    expect(queryByText(/user|host/i)).toBeNull();
  });
});
```

### Important Notes

- Mode state is persisted locally but NOT synced to database (user preference only)
- Chat screen is shared between modes but may show different conversations
- Profile screen is shared and contains the mode toggle
- Non-hosts should never see host-related UI elements
- Default to 'user' mode on first app load

### Future Considerations (Not in This Story)

- Deep linking to specific mode (`laundryshare://host/dashboard`)
- Push notification routing to appropriate mode
- Analytics tracking for mode usage patterns

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-06 | 1.0 | Initial story creation | Sarah (PO) |
